import java.io.*;
import java.net.ServerSocket;
import java.net.Socket;
import java.nio.charset.Charset;


public class HttpOneThread {

    private static ServerSocket sockets;
    static int count =0;

    public static void main(String[] args) {

        int serverPort = 8080; // порт

        try {
            sockets = new ServerSocket(serverPort); /*Сокета  сервера */
        } catch (IOException e) {
            e.printStackTrace(); //Если порт занят
        }

        for (;count<=20 ; count++ ) {

            try {
                System.out.println("Сервер ожидает подключения " + (count) +" раз");
                Socket socket = sockets.accept(); /*Экземпляр класса
                                                Ожидает подключения к sockets*/

                System.out.println("Клиент установил соединение");

                InputStream inputStream = socket.getInputStream();    //Входящий поток данных
                OutputStream outputStream = socket.getOutputStream(); //Исходящий
                //Возвращают поток байт


                InputStreamReader inputStreamReader = new InputStreamReader(inputStream);
                //Работа с входными потоком данных как со строками
                BufferedReader bufferedReader = new BufferedReader(inputStreamReader);
                //Буферизирует символы и позволяет извлекать как строки, так и символы

                String get = bufferedReader.readLine();
                get =  get.substring(get.indexOf("/") + 1, get.lastIndexOf(" "));
                get=java.net.URLDecoder.decode(get,"utf-8");


                /*while (true) {
                    String geti = bufferedReader.readLine();
                    System.out.println("Было получено: " + geti);
                    if (geti.isEmpty()) {break;}
                }*/


                String Head="<head><link rel=\"shortcut icon\" href=\"http://www.iconj.com/ico/h/9/h9arpg5dsi.ico\" type=\"image/x-icon\" /></head>\n";
                String s = "<html>"+Head+"<body><h1>"+"Вы ввели "+get+"</h1></body></html>\n";
                String trr = "HTTP/1.1 400 OK\r\n" +
                        "Server: Brig207\r\n" +
                        "Content-Type: text/html; charset=utf-8\r\n" +
                        "Content-Length: " + s.length() + "\r\n" +
                        "Connection: close\r\n\r\n";

                trr += s;
                outputStream.write((trr).getBytes());


                outputStream.close();


            } catch (IOException e) {
                e.printStackTrace();
            }

            try {
                Thread.sleep(1000);
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
        }

    }


}
